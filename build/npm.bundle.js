!function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e){var r={cloneObject:function(t){var e={};for(var r in t)e[r]=t[r];return e},cloneArray:function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},mapValues:function(t){return Object.keys(t).map(function(e){return t[e]})},compare:function(t,e,r,i){var n=r(t),o=r(e);return n===o?0:null===n||void 0===o?1:null===o||void 0===n?-1:n>o==("ASC"===i)?1:-1},filterByKey:function(t,e){return!e||e[t]},filterByAllKeys:function(t,e){if(!e)return!0;for(var r=0;r<t.length;r++)if(!e[t[r]])return!1;return!0},filterBySomeKeys:function(t,e){if(!e||0===e.length)return!0;for(var r=0;r<e.length;r++)if(t[e[r]])return!0;return!1},filterByContainAllKeys:function(t,e){if(!e)return!0;for(var r=0;r<e.length;r++)if(!t[e[r]])return!1;return!0},filterByRange:function(t,e){return!e||e.min<=t&&t<=e.max},arrayToMap:function(t){if(!t||0===t.length)return null;var e={};return t.forEach(function(t){e[t]=!0}),e}};t.exports=r},function(t,e){var r={__host:{staging:{metasearch:"https://services-desktop-staging.bezurk.org",place:"https://srv.wego.com"},production:{metasearch:"https://srv.wego.com",place:"https://srv.wego.com"}},setEnvironment:function(t){this.env=t},getEnvironment:function(){return this.env||"staging"},searchTrips:function(t,e){var r=this.__host[this.getEnvironment()].metasearch+"/metasearch/flights/searches";return this.post(t,r,e)},searchHotels:function(t,e){var r=this.__host[this.getEnvironment()].metasearch+"/metasearch/hotels/searches";return this.post(t,r,e)},fetchCities:function(t){var e=this.__host[this.getEnvironment()].place+"/places/cities";return this.get(e,t)},fetchAirports:function(t){var e=this.__host[this.getEnvironment()].place+"/places/airports";return this.get(e,t)},post:function(t,e,r){return fetch(this.buildUrl(e,r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(t){return t.ok?t.json():Promise.reject()}).catch(function(t){return Promise.reject(t)})},get:function(t,e){return fetch(this.buildUrl(t,e),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(t){return t.ok?t.json():Promise.reject()}).catch(function(t){return Promise.reject(t)})},buildUrl:function(t,e){if(e){var r=[];for(var i in e){var n=e[i];n instanceof Array?n.forEach(function(t){r.push(i+"[]="+t)}):r.push(i+"="+e[i])}t+="?"+r.join("&")}return t}};t.exports=r},function(t,e,r){var i=r(5),n=r(8),o=r(7),s=function(t){t=t||{},this.currency=t.currency||{},this.locale=t.locale,this.siteCode=t.siteCode,this.paymentMethodIds=t.paymentMethodIds||[],this.providerTypes=t.providerTypes||[],this.onProgressChanged=t.onProgressChanged||function(){},this.onTripsChanged=t.onTripsChanged||function(){},this.onTotalTripsChanged=t.onTotalTripsChanged||function(){},this.onCheapestTripChanged=t.onCheapestTripChanged||function(){},this.onFastestTripChanged=t.onFastestTripChanged||function(){},this.onBestExperienceTripChanged=t.onBestExperienceTripChanged||function(){},this.onDisplayedFilterChanged=t.onDisplayedFilterChanged||function(){},this.onSearchCreated=t.onSearchCreated||function(){},this.__delays=[0,1e3,3e3,4e3,5e3,6e3,6e3,6e3],this.__progressStopAfter=7,this.__merger=new i,this.reset()};s.prototype={searchTrips:function(t){this.search=t,this.reset(),this.updateProgress(),this.updateResult(),this.updateDisplayedFilter(),this._prepareFetch()},handleSearchResponse:function(t){this.mergeResponse(t),this.updateResult(),this.updateDisplayedFilter(),this.updateProgress(),1===this.__fetchCount&&this.onSearchCreated(t.search),this._prepareFetch()},handleSearchError:function(){this._retry()},mergeResponse:function(t){this.__merger.mergeResponse(t),this.__processedFaresCount=t.count,this.__responseSearch=t.search},reset:function(){clearTimeout(this.__timer),this.__abortLastRequest&&this.__abortLastRequest(),this.__merger.reset(),this.__responseSearch={},this.__processedFaresCount=0,this.__fetchCount=0},updatePaymentMethodIds:function(t){this.paymentMethodIds=t,this.reset(),this._prepareFetch()},updateProviderTypes:function(t){this.providerTypes=t,this.reset(),this._prepareFetch()},updateSort:function(t){this.sort=t,this.updateResult()},updateFilter:function(t){this.filter=t,this.updateResult()},updateCurrency:function(t){this.currency=t,this.__merger.updateCurrency(t),this.updateResult(),this.updateDisplayedFilter()},updateProgress:function(){var t,e=this.__fetchCount,r=this.__progressStopAfter,i=this.__processedFaresCount;t=e>=r||i>=1e3?100:e/r*50+i/1e3*50,this.onProgressChanged(t)},updateResult:function(){var t=this.__merger.getTrips(),e=o.filterTrips(t,this.filter),r=n.sortTrips(e,this.sort);this.onTripsChanged(r),this.onCheapestTripChanged(n.getCheapestTrip(e)),this.onFastestTripChanged(n.getFastestTrip(e)),this.onBestExperienceTripChanged(n.getBestExperienceTrip(e)),this.onTotalTripsChanged(t)},updateDisplayedFilter:function(){this.onDisplayedFilterChanged(this.__merger.getFilter())},_fetch:function(){this.__fetchCount++,this.__retryCount=0,this._callApi()},_retry:function(){this.__retryCount<3&&(this.__retryCount++,this._callApi())},_callApi:function(){var t=this,e=!1;this.__abortLastRequest=function(){e=!0},WegoApi.searchTrips(this._getSearchRequestBody(),{currencyCode:this.currency.code,locale:this.locale}).then(function(r){e||t.handleSearchResponse(r)}).catch(function(){t.handleSearchError()})},_prepareFetch:function(){var t=this.__fetchCount,e=this.__delays,r=this;t<e.length&&(this.__timer=setTimeout(function(){r._fetch()},e[t]))},_getSearchRequestBody:function(){var t=this.search||{},e=t.legs||[];return{search:{id:(this.__responseSearch||{}).id,cabin:t.cabin,adultsCount:t.adultsCount,childrenCount:t.childrenCount,infantsCount:t.infantsCount,siteCode:this.siteCode,currencyCode:this.currency.code,locale:this.locale,legs:e.map(function(t){return{departureCityCode:t.departureCityCode,departureAirportCode:t.departureAirportCode,arrivalCityCode:t.arrivalCityCode,arrivalAirportCode:t.arrivalAirportCode,outboundDate:t.outboundDate}})},offset:this.__processedFaresCount,paymentMethodIds:this.paymentMethodIds,providerTypes:this.providerTypes}}},t.exports=s},function(t,e,r){var i=r(9),n=r(12),o=r(11),s=function(t){t=t||{},this.currency=t.currency||{},this.locale=t.locale,this.siteCode=t.siteCode,this.deviceType=t.deviceType||"DESKTOP",this.appType=t.appType,this.rateAmenityIds=t.rateAmenityIds||[],this.onProgressChanged=t.onProgressChanged||function(){},this.onHotelsChanged=t.onHotelsChanged||function(){},this.onTotalHotelsChanged=t.onTotalHotelsChanged||function(){},this.onDisplayedFilterChanged=t.onDisplayedFilterChanged||function(){},this.__delays=[0,300,600,900,2400,3800,5e3,6e3],this.__progressStopAfter=7,this.__merger=new i,this.reset()};s.prototype={searchHotels:function(t){this.search=t,this.reset(),this.updateProgress(),this.updateResult(),this.updateDisplayedFilter(),this._prepareFetch()},handleSearchResponse:function(t){this.mergeResponse(t),this.updateProgress(),this.updateResult(),this.updateDisplayedFilter(),this._prepareFetch()},handleSearchError:function(){this._retry()},mergeResponse:function(t){this.__merger.mergeResponse(t),this.__lastRatesCount=t.count,this.__responseSearch=t.search},reset:function(){clearTimeout(this.__timer),this.__abortLastRequest&&this.__abortLastRequest(),this.__merger.reset(),this.__responseSearch={},this.__lastRatesCount=0,this.__fetchCount=0},updateSort:function(t){this.sort=t,this.updateResult()},updateFilter:function(t){this.filter=t,this.updateResult()},updateCurrency:function(t){this.currency=t,this.__merger.updateCurrency(t),this.updateResult(),this.updateDisplayedFilter()},updateRateAmenityIds:function(t){this.rateAmenityIds=t,this.reset(),this._prepareFetch()},updateProgress:function(){var t,e=this.__fetchCount,r=this.__progressStopAfter,i=this.__lastRatesCount;t=e>=r||i>=1e3?100:e/r*50+i/1e3*50,this.onProgressChanged(t)},updateResult:function(){var t=this.__merger.getHotels(),e=o.filterHotels(t,this.filter),r=n.sortHotels(e,this.sort);this.onHotelsChanged(r),this.onTotalHotelsChanged(t)},updateDisplayedFilter:function(){this.onDisplayedFilterChanged(this.__merger.getFilter())},_fetch:function(){this.__fetchCount++,this.__retryCount=0,this._callApi()},_retry:function(){this.__retryCount<3&&(this.__retryCount++,this._callApi())},_callApi:function(){var t=this,e=!1;this.__abortLastRequest=function(){e=!0},WegoApi.searchHotels(this._getSearchRequestBody(),{currencyCode:this.currency.code,locale:this.locale}).then(function(r){e||t.handleSearchResponse(r)}).catch(function(){t.handleSearchError()})},_prepareFetch:function(){var t=this.__fetchCount,e=this.__delays,r=this;t<e.length&&(this.__timer=setTimeout(function(){r._fetch()},e[t]))},_getSearchRequestBody:function(){var t=this.search||{},e=this.currency||{},r=e.code,i=this.locale;return{search:{id:this.__responseSearch.id,siteCode:this.siteCode,locale:i,currencyCode:r,cityCode:t.cityCode,countryCode:t.countryCode,roomsCount:t.roomsCount,guestsCount:t.guestsCount,checkIn:t.checkIn,checkOut:t.checkOut,deviceType:this.deviceType,appType:this.appType},rateAmenityIds:this.rateAmenityIds,offset:this.__lastRatesCount}}},t.exports=s},function(t,e,r){var i=r(1),n=r(2),o=r(3);t.exports={Api:i,FlightSearchClient:n,HotelSearchClient:o}},function(t,e,r){var i=r(6),n=r(0),o=function(t){t=t||{},this.currency=t.currency};o.prototype={mergeResponse:function(t){var e=this._getUpdatedTripIds(t);this._mergeStaticData(t),this._mergeLegs(t.legs),this._mergeTrips(t.trips),this._mergeFilter(t.filters),this._mergeScores(t.scores),this._mergeFares(t.fares),this._cloneTrips(e)},reset:function(){this.__staticData=this._getEmptyStaticData(),this.__legMap={},this.__tripMap={},this.__trips=[],this.__filter=this._getEmptyFilter(),this.__filterOptionsMap=this._getEmptyFilterOptionsMap()},getTrips:function(){return this.__trips},getFilter:function(){return this.__filter},updateCurrency:function(t){this.currency=t;var e=this,r=this.__tripMap;for(var o in r)r[o].fares.forEach(function(e){e.price=i.convertPrice(e.price,t)});this._cloneTrips(Object.keys(r));var s=this.__filter;this.__filterOptionTypes.forEach(function(r){var o=e.__filterOptionsMap[r];for(var s in o){var a=o[s];a.price=i.convertPrice(a.price,t),o[s]=n.cloneObject(a)}e._buildFilterOptions(r)}),s.minPrice=i.convertPrice(s.minPrice,t),s.maxPrice=i.convertPrice(s.maxPrice,t),this._cloneFilter()},_mergeStaticData:function(t){function e(t,e,i){e&&e.forEach(function(e){var n=e.id||e.code;t[n]=e,"airports"===i?e.city=r.cities[e.cityCode]:"cities"===i&&(e.country=r.countries[e.countryCode])})}var r=this.__staticData;this.__staticDataTypes.forEach(function(i){e(r[i],t[i],i)})},_mergeLegs:function(t){if(t){var e=this,r=this.__legMap;t.forEach(function(t){var n=t.id;r[n]||(i.prepareLeg(t,e.__staticData),r[n]=t)})}},_mergeTrips:function(t){if(t){var e=this,r=this.__tripMap;t.forEach(function(t){var n=t.id;if(!r[n]){var o=t.legIds||[];t.legs=o.map(function(t){return e.__legMap[t]}),i.prepareTrip(t),r[n]=t}})}},_mergeFares:function(t){if(t){var e=this;t.forEach(function(t){i.prepareFare(t,e.currency,e.__staticData);var r=t.tripId,n=e.__tripMap[r];if(n){for(var o=n.fares,s=0;s<o.length;s++){if(t.id===o[s].id)return;if(t.price.amountUsd<o[s].price.amountUsd)break}o.splice(s,0,t)}})}},_mergeScores:function(t){if(t){var e=this.__tripMap;for(var r in t){var i=e[r];i&&(i.score=t[r])}}},_mergeFilter:function(t){if(t){var e=this,r=this.__filter;t.legs&&(t.legs.forEach(function(t){i.prepareLegFilter(t,e.__staticData)}),r.legs=t.legs),t.minPrice&&(r.minPrice=i.convertPrice(t.minPrice,this.currency)),t.maxPrice&&(r.maxPrice=i.convertPrice(t.maxPrice,this.currency)),t.stopoverDurations&&(r.stopoverDurations=t.stopoverDurations),this.__filterOptionTypes.forEach(function(r){(t[r]||[]).forEach(function(t){i.prepareFilterOption(t,r,e.currency,e.__staticData),e.__filterOptionsMap[r][t.code]=t}),e._buildFilterOptions(r)}),this._cloneFilter()}},_getUpdatedTripIds:function(t){var e={},r=this;if(t.scores)for(var i in t.scores)e[i]=!0;return t.fares&&t.fares.forEach(function(t){e[t.tripId]=!0}),Object.keys(e).filter(function(t){return r.__tripMap[t]})},_cloneTrips:function(t){var e=this.__tripMap;t.forEach(function(t){var r=e[t];if(!r)return void console.error("Trip with "+t+" is missing");r.fares=n.cloneArray(r.fares),e[t]=n.cloneObject(r)}),this.__trips=n.mapValues(e)},_cloneFilter:function(){this.__filter=n.cloneObject(this.__filter)},_buildFilterOptions:function(t){this.__filter[t]=n.mapValues(this.__filterOptionsMap[t]),this.__filter[t].sort(function(e,r){if("stops"===t){var i=["DIRECT","ONE_STOP","MORE_THAN_ONE_STOP"];return i.indexOf(e.code)-i.indexOf(r.code)}return e.name<r.name?-1:e.name===r.name?0:1})},_getEmptyFilter:function(){var t={legs:[]};return this.__filterOptionTypes.forEach(function(e){t[e]=[]}),t},_getEmptyFilterOptionsMap:function(){var t={};return this.__filterOptionTypes.forEach(function(e){t[e]={}}),t},_getEmptyStaticData:function(){var t={};return this.__staticDataTypes.forEach(function(e){t[e]={}}),t},__staticDataTypes:["countries","cities","airlines","airports","providers","stops","alliances"],__filterOptionTypes:["airlines","stops","alliances","originAirports","destinationAirports","stopoverAirports"]},t.exports=o},function(t,e){t.exports={prepareTrip:function(t){function e(t){var e={};return t.forEach(function(t){t=t||[],t.forEach(function(t){e[t]=!0})}),e}function r(t){return Object.keys(e(t))}function i(t){var e=0;return t.forEach(function(t){e=Math.max(e,t)}),e}t.fares=[];var n=t.legs;if(n&&0!==n.length){t.legIdMap={},n.forEach(function(e){t.legIdMap[e.id]=!0});var o=n[0];t.stopCode=function(t){var e=0;switch(t.forEach(function(t){e=Math.max(e,t.stopoversCount)}),e){case 0:return"DIRECT";case 1:return"ONE_STOP";default:return"MORE_THAN_ONE_STOP"}}(n),t.airlineCodes=r(n.map(function(t){return t.airlineCodes})),t.allianceCodes=r(n.map(function(t){return t.allianceCodes})),t.departureAirportCode=o.departureAirportCode,t.arrivalAirportCode=o.arrivalAirportCode,t.stopoverAirportCodeMap=e(n.map(function(t){return t.stopoverAirportCodes})),t.changeAirportAtStopover=function(t){for(var e=0;e<t.length-1;e++)if(t[e].arrivalAirportCode!==t[e+1].departureAirportCode)return!0;return!1}(n),t.stopoverDurationMinutes=i(n.map(function(t){return t.stopoverDurationMinutes})),t.durationMinutes=i(n.map(function(t){return t.durationMinutes})),t.departureTimeMinutes=o.departureTimeMinutes,t.arrivalTimeMinutes=n[n.length-1].arrivalTimeMinutes,t.marketingAirline=function(t){for(var e=null,r=0;r<t.length;r++){var i=t[r].longestSegment.airline;if(null===e)e=i;else if(e.code!=i.code)return null}return e}(n)}},prepareLeg:function(t,e){var r=this,i=e.airports;t.departureAirport=i[t.departureAirportCode],t.arrivalAirport=i[t.arrivalAirportCode];var n=t.segments||[];n.forEach(function(t){r.prepareSegment(t,e)});var o=n.map(function(t){return t}).sort(function(t,e){return e.durationMinutes-t.durationMinutes});t.longestSegment=o[0];var s=o.map(function(t){return t.airline});t.airlines=function(t){return t.filter(function(t,e,r){return r.indexOf(t)==e})}(s)},prepareSegment:function(t,e){var r=e.airlines,i=e.airports;t.airline=r[t.airlineCode],t.operatingAirline=r[t.operatingAirlineCode],t.departureAirport=i[t.departureAirportCode],t.arrivalAirport=i[t.arrivalAirportCode]},prepareFare:function(t,e,r){t.provider=r.providers[t.providerCode],t.price=this.convertPrice(t.price,e)},prepareFilterOption:function(t,e,r,i){var n=this.__filterOptionTypeToStaticDataType[e],o=i[n]||{},s=o[t.code]||{};t.name=s.name,t.item=s,t.price=this.convertPrice(t.price,r)},prepareLegFilter:function(t,e){t.departureCity=e.cities[t.departureCityCode],t.departureAirport=e.airports[t.departureAirportCode],t.arrivalCity=e.cities[t.arrivalCityCode],t.arrivalAirport=e.airports[t.arrivalAirportCode]},convertPrice:function(t,e){if(!e)return t;if(!t)return null;var r=t.amount,i=t.totalAmount;if(t.currencyCode!=e.code){var n=e.rate;r=t.amountUsd*n,i=t.totalAmountUsd*n}return{currency:e,amount:r,totalAmount:i,amountUsd:t.amountUsd,totalAmountUsd:t.totalAmountUsd}},__filterOptionTypeToStaticDataType:{airlines:"airlines",stops:"stops",alliances:"alliances",originAirports:"airports",destinationAirports:"airports",stopoverAirports:"airports"}}},function(t,e,r){function i(t,e){return!e||e[t]}function n(t,e){if(!e)return!0;for(var r=0;r<t.length;r++)if(!e[t[r]])return!1;return!0}function o(t,e){if(!e||0===e.length)return!0;for(var r=0;r<e.length;r++)if(t[e[r]])return!0;return!1}function s(t,e){if(!e)return!0;for(var r=0;r<e.length;r++)if(!t[e[r]])return!1;return!0}function a(t,e){return!e||e.min<=t&&t<=e.max}r(0);t.exports={filterTrips:function(t,e){function r(t,e){return!e||t.fares[0]&&a(t.fares[0].price.amountUsd,e)}function c(t,e){if(!e)return!0;for(var r=0;r<e.length;r++)if("SAME_AIRLINE"===e[r]&&t.airlineCodes.length>1)return!1;return!0}function u(t,e){if(!e||0===e.length)return!0;for(var r=0;r<e.length;r++)if("NOT_CHANGE_AIRPORT"===e[r]&&t.changeAirportAtStopover)return!1;return!0}function p(t,e){if(!e)return!0;for(var r=0;r<e.length;r++){if("NOT_OVERNIGHT"===e[r]&&t.overnight)return!1;if("SHORT_STOPOVER"===e[r]&&t.longStopover)return!1}return!0}function h(t,e,r){if(!e)return!0;for(var i=0;i<e.length;i++){var n=e[i];if(!a(t.legs[n.legIndex][r],n))return!1}return!0}function f(t,e){return!e||!!t.marketingAirline&&i(t.marketingAirline.code,e)}function l(t){if(!t||0===t.length)return null;var e={};return t.forEach(function(t){e[t]=!0}),e}if(!e)return t;var _=l(e.stopCodes),d=l(e.airlineCodes),g=l(e.allianceCodes),v=l(e.originAirportCodes),m=l(e.destinationAirportCodes);return t.filter(function(t){return r(t,e.priceRange)&&i(t.stopCode,_)&&h(t,e.departureTimeMinutesRanges,"departureTimeMinutes")&&h(t,e.arrivalTimeMinutesRanges,"arrivalTimeMinutes")&&f(t,d)&&n(t.allianceCodes,g)&&c(t,e.tripOptions)&&i(t.departureAirportCode,v)&&i(t.arrivalAirportCode,m)&&o(t.stopoverAirportCodeMap,e.stopoverAirportCodes)&&u(t,e.stopoverOptions)&&h(t,e.durationMinutesRanges,"durationMinutes")&&a(t.stopoverDurationMinutes,e.stopoverDurationMinutesRange)&&p(t,e.itineraryOptions)&&s(t.legIdMap,e.legIds)})}}},function(t,e,r){var i=r(0);t.exports={sortTrips:function(t,e){function r(t){return t.fares[0]?t.fares[0].price.amountUsd:null}function n(t){return t.durationMinutes}function o(t){return function(e){return e.legs[t].departureTimeMinutes}}function s(t){return function(e){return e.legs[t].arrivalTimeMinutes}}function a(t){return t.score}if(!e)return t;var c={PRICE:r,DURATION:n,OUTBOUND_DEPARTURE_TIME:o(0),INBOUND_DEPARTURE_TIME:o(1),OUTBOUND_ARRIVAL_TIME:s(0),INBOUND_ARRIVAL_TIME:s(1),SCORE:a},u=c[e.by]||function(){},p=i.cloneArray(t);return p.sort(function(t,n){var o=i.compare(t,n,u,e.order);return 0==o&&"PRICE"!=e.by?i.compare(t,n,r,"ASC"):o}),p},getCheapestTrip:function(t){return this._getBestTripBy(t,function(t,e){return t.fares[0].price.amountUsd<e.fares[0].price.amountUsd})},getFastestTrip:function(t){return this._getBestTripBy(t,function(t,e){return t.durationMinutes===e.durationMinutes?t.fares[0].price.amountUsd<e.fares[0].price.amountUsd:t.durationMinutes<e.durationMinutes})},getBestExperienceTrip:function(t){return this._getBestTripBy(t,function(t,e){return t.score===e.score?t.fares[0].price.amountUsd<e.fares[0].price.amountUsd:t.score>e.score})},_getBestTripBy:function(t,e){for(var r=t[0],i=1;i<t.length;i++)e(t[i],r)&&(r=t[i]);return r}}},function(t,e,r){var i=r(0),n=r(10),o=function(t){t=t||{},this.currency=t.currency};o.prototype={reset:function(){this.__staticData=this._getEmptyStaticData(),this.__hotelMap={},this.__hotels=[],this.__filter=this._getEmptyFilter(),this.__filterOptionsMap=this._getEmptyFilterOptionsMap()},mergeResponse:function(t){var e=this._getUpdatedHotelIds(t);this._mergeStaticData(t),this._mergeHotels(t.hotels),this._mergeFilter(t.filter),this._mergeRates(t.rates),this._mergeScores(t.scores),this._mergeRatesCounts(t.providerRatesCounts),this._cloneHotels(e)},getFilter:function(){return this.__filter},getHotels:function(){return this.__hotels},updateCurrency:function(t){this.currency=t;var e=this.__hotelMap;for(var r in e)e[r].rates.forEach(function(e){e.price=n.convertPrice(e.price,t)});this._cloneHotels(Object.keys(e));var o=this.__filter;o.minPrice=n.convertPrice(o.minPrice,t),o.maxPrice=n.convertPrice(o.maxPrice,t),this.__filter=i.cloneObject(this.__filter)},_mergeStaticData:function(t){function e(t,e){e&&e.forEach(function(e){var r=e.code||e.id;t[r]=e})}var r=this.__staticData;this.__staticDataTypes.forEach(function(i){e(r[i],t[i])})},_mergeHotels:function(t){if(t){var e=this,r=this.__hotelMap;t.forEach(function(t){n.prepareHotel(t,e.__staticData),r[t.id]=r[t.id]||t})}},_mergeRates:function(t){if(t){var e=this;t.forEach(function(t){n.prepareRate(t,e.currency,e.__staticData);var r=t.hotelId,i=e.__hotelMap[r];if(i){var o,s=i.rates;for(o=0;o<s.length&&!n.isBetterRate(t,s[o]);o++)if(t.providerCode===s[o].providerCode)return;for(s.splice(o,0,t),o++;o<s.length;o++)if(t.providerCode===s[o].providerCode){s.splice(o,1);break}}})}},_mergeScores:function(t){if(t){var e=this.__hotelMap;for(var r in t){var i=e[r];i&&(i.score=t[r])}}},_mergeRatesCounts:function(t){if(t){var e=this;t.forEach(function(t){var r=e.__hotelMap[t.hotelId];if(r){var i=t.providerCode,n=t.ratesCount,o=r.ratesCounts[i]||0;r.ratesCounts[i]=n,r.ratesCounts.total-=o,r.ratesCounts.total+=n}})}},_mergeFilter:function(t){if(t){var e=this.__filter,r=this;t.minPrice&&(e.minPrice=n.convertPrice(t.minPrice,this.currency)),t.maxPrice&&(e.maxPrice=n.convertPrice(t.maxPrice,this.currency)),this.__filterOptionTypes.forEach(function(e){(t[e]||[]).forEach(function(t){n.prepareFilterOption(t,e,r.__staticData),r.__filterOptionsMap[e][t.code]=t}),r._buildFilterOptions(e)}),this.__filter=i.cloneObject(this.__filter)}},_getEmptyStaticData:function(){var t={};return this.__staticDataTypes.forEach(function(e){t[e]={}}),t},_getEmptyFilterOptionsMap:function(){var t={};return this.__filterOptionTypes.forEach(function(e){t[e]={}}),t},_buildFilterOptions:function(t){this.__filter[t]=i.mapValues(this.__filterOptionsMap[t]).sort(function(t,e){return t.name<e.name?-1:t.name===e.name?0:1})},_getEmptyFilter:function(){var t={};return this.__filterOptionTypes.forEach(function(e){t[e]=[]}),t},_getUpdatedHotelIds:function(t){var e={},r=this;if(t.rates&&t.rates.forEach(function(t){e[t.hotelId]=!0}),t.scores)for(var i in t.scores)e[i]=!0;return t.providerRatesCounts&&t.providerRatesCounts.forEach(function(t){e[t.hotelId]=!0}),Object.keys(e).filter(function(t){return r.__hotelMap[t]})},_cloneHotels:function(t){var e=this.__hotelMap;t.forEach(function(t){var r=e[t];if(!r)return void console.error("Hotel with "+t+" is missing");r.rates=i.cloneArray(r.rates),r.ratesCounts=i.cloneObject(r.ratesCounts),e[t]=i.cloneObject(r)}),this.__hotels=i.mapValues(e)},__staticDataTypes:["stars","brands","propertyTypes","districts","amenities","rateAmenities","chains","reviewerGroups","providers"],__filterOptionTypes:["stars","brands","propertyTypes","districts","amenities","rateAmenities","chains","reviewerGroups"]},t.exports=o},function(t,e){t.exports={prepareHotel:function(t,e){t.district=e.districts[t.districtId],t.reviewMap=function(t,e){if(!t)return{};var r={};return t.forEach(function(t){r[e(t)]=t}),r}(t.reviews,function(t){return t.reviewerGroup}),t.ratesCounts={total:0};var r={};(t.amenityIds||[]).forEach(function(t){r[t]=!0}),t.amenityIdMap=r,t.rates=[],t.images=t.images||[]},prepareRate:function(t,e,r){t.provider=r.providers[t.providerCode],t.price=this.convertPrice(t.price,e)},convertPrice:function(t,e){if(!e)return t;if(!t)return null;var r=t.amount,i=t.totalAmount;if(t.currencyCode!=e.code){var n=e.rate;r=t.amountUsd*n,i=t.totalAmountUsd*n}return{currency:e,amount:r,totalAmount:i,amountUsd:t.amountUsd,totalAmountUsd:t.totalAmountUsd}},prepareFilterOption:function(t,e,r){var i=this.__filterOptionTypeToStaticDataType[e],n=r[i]||{},o=n[t.code]||{};t.name=o.name},isBetterRate:function(t,e){function r(t){var e=t.price.amount;return e>99999&&(e=e/100*100),e}function i(t){return t.price.taxAmountUsd<0?-1:1}var n=i(t),o=i(e);if(n!=o)return n>o;var s=r(t),a=r(e);return s!=a?s<a:t.ecpc>e.ecpc},__filterOptionTypeToStaticDataType:{stars:"stars",brands:"brands",propertyTypes:"propertyTypes",districts:"districts",amenities:"amenities",rateAmenities:"rateAmenities",chains:"chains",reviewerGroups:"reviewerGroups"}}},function(t,e){t.exports={filterHotels:function(t,e){function r(t,e){return!e||e[t]}function i(t,e){if(!e)return!0;var r=!0;return e.forEach(function(e){t[e]||(r=!1)}),r}function n(t,e){return!e||e.min<=t&&t<=e.max}function o(t,e){return!e||t.indexOf(e)>-1}function s(t,e){return!e.reviewScoreRange||n((t.reviewMap.ALL||{}).score,e.reviewScoreRange)}function a(t,e){if(!e)return!0;for(var r=0;r<e.length;r++){var i=t.reviewMap[e[r]];if(i&&i.score>=80)return!0}return!1}function c(t,e){return!e||t.rates[0]&&n(t.rates[0].price.amountUsd,e)}function u(t){if(!t)return null;var e={};return t.forEach(function(t){e[t]=!0}),e}if(!e)return t;var p=u(e.stars),h=u(e.districtIds),f=u(e.propertyTypeIds),l=u(e.brandIds),_=u(e.chainIds);return t.filter(function(t){return c(t,e.priceRange)&&r(t.star,p)&&s(t,e)&&i(t.amenityIdMap,e.amenityIds)&&r(t.districtId,h)&&r(t.propertyTypeId,f)&&r(t.brandId,l)&&o(t.name,e.name)&&r(t.chainId,_)&&a(t,e.reviewerGroups)})}}},function(t,e,r){var i=r(0);t.exports={sortHotels:function(t,e){function r(t){return t.rates&&t.rates.length>0?t.rates[0].price.amountUsd:null}function n(t){return function(e){var r=e.reviewMap[t];return r?r.score:null}}function o(t){return t.star}function s(t){return t.score}function a(t){return t.distanceToCityCentre}function c(t){return t.distanceToNearestAirport}if(!e)return t;var u={PRICE:r,ALL_REVIEW_SCORE:n("ALL"),FAMILY_REVIEW_SCORE:n("FAMILY"),BUSINESS_REVIEW_SCORE:n("BUSINESS"),COUPLE_REVIEW_SCORE:n("COUPLE"),SOLO_REVIEW_SCORE:n("SOLO"),STAR:o,SCORE:s,DISTANCE_TO_CITY_CENTER:a,DISTANCE_TO_NEAREST_AIRPORT:c},p=u[e.by]||function(){},h=i.cloneArray(t);return h.sort(function(t,n){var o=i.compare(t,n,p,e.order);return 0==o&&"PRICE"!=e.by?i.compare(t,n,r,"ASC"):o}),h}}}]);